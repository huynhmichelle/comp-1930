<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://cdn.datatables.net/1.10.20/css/dataTables.bootstrap4.min.css">
        <link rel="stylesheet" href="styles/header.css">
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
        <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
        <script src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.3.0/firebase-firestore.js"></script>
        <style>
            input.largerCheckbox { 
                transform : scale(2); 
            }
            .table-striped>tbody>tr:nth-child(odd)>td,
            .table-striped>tbody>tr:nth-child(odd)>th {
                background-color: whitesmoke;
                color: black;
            }
            .table-striped>tbody>tr:nth-child(even)>td,
            .table-striped>tbody>tr:nth-child(even)>th {
                background-color: #ECEFF1;
                color: black;
            }
        </style>
    </head>
    <body>
    <nav id="navbar-site" class="navbar navbar-dark headerstyle navbar-expand-sm">
        <div class="navbar-header">
            <div id="main;buttonstyle">
                    <button class="openbtn" onclick="openNav()" style="float:left">☰</button>  
                </div>
        <div class="container">
                <a href="#"><img src="./images/user-2.png" width="65px", height="65px" id="img_float"></a>
                <a class="navbar-brand" href="#"style="font-size:40px">APP NAME</a>
                    <div id="img_float">
                        <a href="#"><img src="./images/mail-2.png" width="35px", height="35px"></a><br>
                        <a href="#"><img src="./images/bell-2.png" width="35px", height="35px"></a>
                    </div>
                </div>
                <div id="mySidebar" class="sidebar">
                    <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">×</a>
                    <a href="#">Homepage</a>
                    <a href="#">User profile</a>
                    <a href="#">About us</a>
                    <a href="#">FAQ</a>
                    <a href="#">Contact us</a>
                    <a href="#">Logout</a>
                </div>
        </div>
    </nav>
        
        <div id='results-and-filters' style="width:90%;margin-left:auto;margin-right:auto;margin-top:1%;">
            <div class="filters-dropdown">
                <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Filters</button>
                <button id='clear-filters' onclick='clearFilters();'>Clear</button>
                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton" style="padding: 10px 0px 50px 50px;font-size: 18px;">
                    <div class="d-flex justify-content-center my-4">
                        <form class="range-field w-100" style="font-size:20px;">
                            Budget:&nbsp;&nbsp;&nbsp;&nbsp;<input style="border:None;" type="text" id="slider-value" value=""><br>
                            <span>$0 </span>
                            <input class="border-0" type="range" min="0" max="1000" value="700" onchange="budgetFilterChanged(this.value);"/>
                            <span>$1000 </span>
                        </form>
                    </div>
                    <input class="largerCheckbox" type="checkbox" value="pets">&nbsp;&nbsp;Pets OK<br>
                    <input class="largerCheckbox" type="checkbox" value="student">&nbsp;&nbsp;Student<br>
                    <input class="largerCheckbox" type="checkbox" value="employed">&nbsp;&nbsp;Employed<br>
                </div>
            </div>
            
        
            <table id='results' class="table table-striped table-bordered"></table>
        </div>
        
        <script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-auth.js"></script>
        <script>
            // Your web app's Firebase configuration
            var firebaseConfig = {
                apiKey: "AIzaSyCOl7zfOtE5H75WPViBv-jNxn9nZLhHNFo",
                authDomain: "fire1-2c085.firebaseapp.com",
                databaseURL: "",
                projectId: "fire1-2c085",
                storageBucket: "fire1-2c085.appspot.com",
                messagingSenderId: "228703666474",
                appId: "1:228703666474:web:3bacd2b08daf85a79cde53",
                measurementId: "G-8V89TB50QY"
            };
            // Initialize Firebase
            firebase.initializeApp(firebaseConfig);
            
            // Initialize Firestore and create new document in users collection
            var db = firebase.firestore();
        </script>
        
        <script>
            function openNav() {
                document.getElementById("mySidebar").style.width = "250px";
                document.getElementById("main").style.marginLeft = "250px";
            }
            function closeNav() {
                document.getElementById("mySidebar").style.width = "0";
                document.getElementById("main").style.marginLeft= "0";
            }
        </script>
        
        
        <script>
            db.collection('rentals')
                .get()
                .then(function(querySnapshot) {
                let dataSet = [];
                querySnapshot.forEach(function(doc) {
                    //console.log(doc.id, " => ", doc.data());
                    dataSet.push({
                        'id': doc.data().rental_id, 
                        'price': doc.data().rent_price,
                        'pets_ok': doc.data().pets_ok });
                });
                populateTable(dataSet);
            })
                .catch(function(error) {
                console.log("Error getting documents: ", error);
            });
            
        </script>
        
        <script>
            function populateTable(dataSet){
                var testData = [{ "id":"John", "price":31, "pets_ok":"123 Street" },
                                { "id":"Jacky", "price":62, "pets_ok":"123 Street" }];
                console.table(dataSet);
                var table = $('#results').DataTable( {
                    data: dataSet,
                    //data: testData,
                    columns: [
                        {title: "ID", 'data':'id'},
                        {title: "Price", 'data':'price'},
                        {title: "Pets Ok", 'data':'pets_ok'},
                    ]
                });
            }
            
            /*
            num_roommates 2
            pets_ok false
            rent_price 1400
            rental_id 7
            student_tenant false 
            */
                
            function clearFilters(){
                var table = $('#results').DataTable();
                table.row.add(hiddenRows);
            }

        </script>
        
        <script>
            var hiddenRows = [];
            function budgetFilterChanged(val) {
                document.getElementById('slider-value').value='$'+val;
                console.log(parseInt(val));
                var table = $('#results').DataTable();
                //table.search('').columns().search('').draw();
                var hiddenRows = table.rows( function(idx, data, node) {
                    return !(parseInt(data[2].replace('$','')) < parseInt(val));
                } );
                hiddenRows.every( function ( rowIdx, tableLoop, rowLoop ) {
                    var data = this.data();
                    console.log(data);
                    //hiddenRows.push(this.data);
                    //this.node().addClass("deleted");
                    this.node().className += " deleted";
                    } );
                table.draw();

                
            }
        </script>
        
    </body>
</html>